<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aakaara Studios — Quote Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="https://use.typekit.net/uyl0arj.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=DM+Sans:wght@300;400;500;600;700&display=swap');

:root {
  --bg: #0a0a0a;
  --surface: #111111;
  --surface2: #1a1a1a;
  --gold: #c9956b;
  --gold-dim: rgba(201,149,107,0.15);
  --gold-border: rgba(201,149,107,0.25);
  --cream: #f0ebe4;
  --muted: #8a8580;
  --dark: #1e1a16;
  --font-display: 'Cormorant Garamond', serif;
  --font-body: 'DM Sans', sans-serif;
  --ease: cubic-bezier(0.16, 1, 0.3, 1);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { -webkit-font-smoothing: antialiased; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--cream);
  min-height: 100vh;
  overflow-x: hidden;
}

/* === LOGIN SCREEN === */
.login-screen {
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  background: var(--bg);
  transition: opacity 0.6s var(--ease), visibility 0.6s;
}
.login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.login-box {
  text-align: center; width: 320px;
}
.login-box .logo-text {
  font-family: var(--font-display); font-size: 1.1rem;
  letter-spacing: 0.3em; color: var(--gold); margin-bottom: 0.3rem;
}
.login-box .logo-sub {
  font-size: 0.55rem; letter-spacing: 0.25em; color: var(--muted); margin-bottom: 2.5rem;
}
.login-box input {
  width: 100%; padding: 14px 18px;
  background: var(--surface); border: 1px solid var(--gold-border);
  border-radius: 8px; color: var(--cream); font-size: 0.85rem;
  font-family: var(--font-body); outline: none;
  transition: border-color 0.3s;
  text-align: center; letter-spacing: 0.15em;
}
.login-box input:focus { border-color: var(--gold); }
.login-box input::placeholder { color: var(--muted); letter-spacing: 0.1em; }
.login-error {
  font-size: 0.7rem; color: #e06050; margin-top: 0.8rem;
  opacity: 0; transition: opacity 0.3s;
}
.login-error.show { opacity: 1; }

/* === MAIN APP === */
.app { display: none; }
.app.visible { display: block; }

/* Top bar */
.topbar {
  position: sticky; top: 0; z-index: 100;
  padding: 1rem 2rem;
  display: flex; align-items: center; justify-content: space-between;
  background: rgba(10,10,10,0.85);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(201,149,107,0.1);
}
.topbar-brand {
  font-family: var(--font-display); font-size: 0.9rem;
  letter-spacing: 0.25em; color: var(--gold);
}
.topbar-title {
  font-size: 0.65rem; letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase;
}
.topbar-actions { display: flex; gap: 0.8rem; }

/* Buttons */
.btn {
  padding: 10px 22px; border-radius: 6px; border: none;
  font-family: var(--font-body); font-size: 0.75rem;
  letter-spacing: 0.08em; cursor: pointer;
  transition: all 0.3s var(--ease); font-weight: 500;
}
.btn-primary {
  background: var(--gold); color: var(--dark);
}
.btn-primary:hover { background: #d4a57a; transform: translateY(-1px); }
.btn-ghost {
  background: transparent; color: var(--cream);
  border: 1px solid rgba(255,255,255,0.15);
}
.btn-ghost:hover { border-color: var(--gold); color: var(--gold); }
.btn-danger {
  background: transparent; color: #e06050;
  border: 1px solid rgba(224,96,80,0.3);
}
.btn-danger:hover { background: rgba(224,96,80,0.1); }
.btn-small { padding: 6px 14px; font-size: 0.7rem; }

/* Layout */
.container {
  max-width: 900px; margin: 0 auto;
  padding: 2rem 2rem 4rem;
}

/* Sections */
.section {
  background: var(--surface);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 1.8rem;
  margin-bottom: 1.2rem;
}
.section-label {
  font-size: 0.6rem; letter-spacing: 0.25em; color: var(--gold);
  text-transform: uppercase; margin-bottom: 1.2rem;
  display: flex; align-items: center; gap: 0.5rem;
}
.section-label::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, var(--gold-border), transparent);
}

/* Form elements */
.form-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
  margin-bottom: 1rem;
}
.form-row.three { grid-template-columns: 1fr 1fr 1fr; }
.form-row.single { grid-template-columns: 1fr; }
.form-group { display: flex; flex-direction: column; gap: 0.4rem; }
.form-label {
  font-size: 0.65rem; letter-spacing: 0.1em; color: var(--muted);
  text-transform: uppercase;
}
.form-input, .form-select, .form-textarea {
  padding: 11px 14px;
  background: var(--surface2); border: 1px solid rgba(255,255,255,0.08);
  border-radius: 6px; color: var(--cream); font-size: 0.85rem;
  font-family: var(--font-body); outline: none;
  transition: border-color 0.3s;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  border-color: var(--gold);
}
.form-input::placeholder { color: rgba(138,133,128,0.5); }
.form-select {
  cursor: pointer;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238a8580' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}
.form-select option { background: var(--surface2); color: var(--cream); }
.form-textarea { resize: vertical; min-height: 70px; }
.form-checkbox {
  display: flex; align-items: center; gap: 0.6rem; cursor: pointer;
}
.form-checkbox input[type="checkbox"] {
  width: 16px; height: 16px; accent-color: var(--gold); cursor: pointer;
}
.form-checkbox span { font-size: 0.8rem; color: var(--cream); }

/* Event days */
.day-block {
  background: var(--surface2); border-radius: 8px;
  padding: 1.2rem; margin-bottom: 1rem;
  border: 1px solid rgba(255,255,255,0.04);
}
.day-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1rem;
}
.day-title {
  font-family: var(--font-display); font-size: 1rem;
  color: var(--cream); font-weight: 500;
}
.day-remove {
  background: none; border: none; color: var(--muted);
  cursor: pointer; font-size: 0.7rem; padding: 4px 10px;
  border-radius: 4px; transition: all 0.2s;
}
.day-remove:hover { color: #e06050; background: rgba(224,96,80,0.1); }

/* Event items within a day */
.event-item {
  display: grid; grid-template-columns: 2fr 1fr 2fr 30px; gap: 0.8rem;
  align-items: end; margin-bottom: 0.8rem;
}
.event-remove {
  background: none; border: none; color: var(--muted);
  cursor: pointer; font-size: 1rem; padding: 8px 0;
  transition: color 0.2s;
}
.event-remove:hover { color: #e06050; }
.add-btn {
  width: 100%; padding: 8px;
  background: transparent; border: 1px dashed rgba(201,149,107,0.3);
  border-radius: 6px; color: var(--gold); font-size: 0.75rem;
  font-family: var(--font-body); cursor: pointer;
  transition: all 0.3s;
}
.add-btn:hover { background: var(--gold-dim); border-color: var(--gold); }

/* Deliverable checkboxes */
.deliverables-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem;
}

/* Pricing badge */
.pricing-badge {
  display: inline-flex; align-items: center; gap: 0.4rem;
  padding: 4px 12px; border-radius: 20px;
  background: var(--gold-dim); border: 1px solid var(--gold-border);
  font-size: 0.65rem; color: var(--gold); letter-spacing: 0.1em;
}

/* Preview card */
.preview-summary {
  background: var(--surface2); border-radius: 8px;
  padding: 1.2rem; margin-top: 1rem;
}
.preview-row {
  display: flex; justify-content: space-between;
  padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 0.8rem;
}
.preview-row:last-child { border: none; }
.preview-row .label { color: var(--muted); }
.preview-row .value { color: var(--cream); font-weight: 500; }
.preview-row.total { border-top: 1px solid var(--gold-border); padding-top: 0.8rem; margin-top: 0.3rem; }
.preview-row.total .value { color: var(--gold); font-size: 1.1rem; font-weight: 700; }

/* Generate bar */
.generate-bar {
  position: sticky; bottom: 0;
  padding: 1rem 2rem;
  background: rgba(10,10,10,0.9);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(201,149,107,0.1);
  display: flex; align-items: center; justify-content: space-between;
}
.generate-bar .total-display {
  font-family: var(--font-display); font-size: 1.8rem;
  color: var(--cream); font-weight: 400;
}
.generate-bar .total-label {
  font-size: 0.6rem; letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase;
}

/* Toast */
.toast {
  position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
  padding: 12px 24px; border-radius: 8px;
  background: var(--gold); color: var(--dark);
  font-size: 0.8rem; font-weight: 500;
  opacity: 0; transition: all 0.4s var(--ease);
  pointer-events: none; z-index: 200;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Preview Modal */
.preview-modal {
  position: fixed; inset: 0; z-index: 2000;
  background: rgba(0,0,0,0.95);
  display: flex; flex-direction: column;
  opacity: 0; visibility: hidden; transition: all 0.3s;
}
.preview-modal.show { opacity: 1; visibility: visible; }
.preview-header {
  padding: 1rem 2rem; background: var(--surface);
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.preview-body { flex: 1; width: 100%; height: 100%; overflow: hidden; }
.preview-frame { width: 100%; height: 100%; border: none; }

/* Responsive */
@media (max-width: 600px) {
  .form-row { grid-template-columns: 1fr; }
  .form-row.three { grid-template-columns: 1fr; }
  .event-item { grid-template-columns: 1fr; }
  .deliverables-grid { grid-template-columns: 1fr; }
  .container { padding: 1rem; }
  .topbar { padding: 0.8rem 1rem; }
  .generate-bar { padding: 0.8rem 1rem; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="logo-text">Aakaara Studios</div>
    <div class="logo-sub">QUOTE GENERATOR</div>
    <input type="password" id="loginPass" placeholder="Enter access code" onkeydown="if(event.key==='Enter')doLogin()">
    <div class="login-error" id="loginError">Incorrect access code</div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">

  <!-- Top bar -->
  <div class="topbar">
    <div>
      <div class="topbar-brand">Aakaara Studios</div>
      <div class="topbar-title">Quote Generator</div>
    </div>
    <div class="topbar-actions">
      <button class="btn btn-ghost btn-small" onclick="resetForm()">New Quote</button>
    </div>
  </div>

  <div class="container">

    <!-- CLIENT INFO -->
    <div class="section">
      <div class="section-label">Client Information</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Client Name(s)</label>
          <input class="form-input" id="clientName" placeholder="e.g. Asrita & Varun">
        </div>
        <div class="form-group">
          <label class="form-label">Client Email</label>
          <input class="form-input" type="email" id="clientEmail" placeholder="client@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Event Type</label>
          <select class="form-select" id="eventType">
            <option value="Wedding Photography">Wedding</option>
            <option value="Engagement Photography">Engagement</option>
            <option value="Gender Reveal Photography">Gender Reveal</option>
            <option value="Birthday Photography">Birthday</option>
            <option value="Baby Shower Photography">Baby Shower</option>
            <option value="House Warming Photography">House Warming</option>
            <option value="Event Photography">Other Event</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Location</label>
          <input class="form-input" id="location" placeholder="e.g. San Antonio, Texas">
        </div>
        <div class="form-group">
          <label class="form-label">Quote Date</label>
          <input class="form-input" type="date" id="quoteDate">
        </div>
      </div>
    </div>

    <!-- EVENT DAYS -->
    <div class="section">
      <div class="section-label">Event Schedule</div>
      <div id="daysContainer"></div>
      <button class="add-btn" onclick="addDay()">+ Add Day</button>
    </div>

    <!-- DELIVERABLES -->
    <div class="section">
      <div class="section-label">Deliverables</div>
      <div class="deliverables-grid">
        <label class="form-checkbox"><input type="checkbox" id="delEdited" checked><span>Edited Photos</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delRaw" checked><span>Raw Images</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delGallery" checked><span>Online Gallery</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delSneakPeek"><span>Sneak Peek Reels</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delTeaser"><span>Wedding Teaser (2-3 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delDoc"><span>Documentary Film (10 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delTraditional"><span>Traditional Video (Full)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delHighlight"><span>Highlight Video (2-3 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delDrone"><span>Drone Footage</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delLive"><span>Live Wedding Coverage</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delSecondShooter"><span>Second Shooter</span></label>
      </div>
      <div class="form-row" style="margin-top:1rem;">
        <div class="form-group">
          <label class="form-label">Total Edited Photos</label>
          <input class="form-input" type="number" id="editedCount" placeholder="e.g. 500" value="200">
        </div>
        <div class="form-group">
          <label class="form-label">Delivery Timeline</label>
          <input class="form-input" id="timeline" placeholder="e.g. 6-8 weeks" value="6-8 weeks">
        </div>
      </div>
      <div class="form-row single" style="margin-top:0.5rem;">
        <div class="form-group">
          <label class="form-label">Custom Deliverable Notes (optional)</label>
          <textarea class="form-textarea" id="customNotes" placeholder="Any extra notes about deliverables..."></textarea>
        </div>
      </div>
    </div>

    <!-- PRICING -->
    <div class="section">
      <div class="section-label">Pricing</div>
      <div class="form-row three">
        <div class="form-group">
          <label class="form-label">Pricing Model</label>
          <select class="form-select" id="pricingModel" onchange="updatePricingUI()">
            <option value="hourly">Hourly Rate</option>
            <option value="flat">Flat Package</option>
          </select>
        </div>
        <div class="form-group" id="hourlyRateGroup">
          <label class="form-label">Hourly Rate ($)</label>
          <input class="form-input" type="number" id="hourlyRate" value="300">
        </div>
        <div class="form-group" id="flatRateGroup" style="display:none;">
          <label class="form-label">Package Price ($)</label>
          <input class="form-input" type="number" id="flatRate" placeholder="e.g. 1200">
        </div>
        <div class="form-group">
          <label class="form-label">Travel & Accommodation</label>
          <select class="form-select" id="travelType">
            <option value="separate">Calculated Separately</option>
            <option value="included">Included in Price</option>
            <option value="fixed">Fixed Amount</option>
            <option value="none">N/A (Local)</option>
          </select>
        </div>
      </div>
      <div class="form-row" id="travelFixedRow" style="display:none;">
        <div class="form-group">
          <label class="form-label">Travel Amount ($)</label>
          <input class="form-input" type="number" id="travelAmount" placeholder="e.g. 500">
        </div>
      </div>
      <div class="form-row">
        <label class="form-checkbox">
          <input type="checkbox" id="showIntro" onchange="updatePricingUI()">
          <span>Show as Introductory/Special Rate</span>
        </label>
        <div class="form-group" id="standardRateGroup" style="display:none;">
          <label class="form-label">Standard Rate (strikethrough)</label>
          <input class="form-input" id="standardRate" placeholder="e.g. $1,200">
        </div>
      </div>

      <!-- Live preview -->
      <div class="preview-summary" id="pricingPreview"></div>
    </div>

    <!-- ADDITIONAL NOTES -->
    <div class="section">
      <div class="section-label">Additional Terms</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Deposit Requirement</label>
          <input class="form-input" id="deposit" value="50% deposit required to secure dates">
        </div>
        <div class="form-group">
          <label class="form-label">Quote Validity</label>
          <input class="form-input" id="validity" value="30 days">
        </div>
      </div>
      <div class="form-row single">
        <div class="form-group">
          <label class="form-label">Extra Notes (optional)</label>
          <textarea class="form-textarea" id="extraNotes" placeholder="e.g. Multi-day discount applied, package can be customized..."></textarea>
        </div>
      </div>
    </div>

  </div>

  <!-- Sticky generate bar -->
  <div class="generate-bar">
    <div>
      <div class="total-label">Estimated Total</div>
      <div class="total-display" id="totalDisplay">$0</div>
    </div>
    <div style="display:flex;gap:0.8rem;">
      <button class="btn btn-danger" onclick="resetForm()" style="font-size:0.85rem;padding:14px 20px;">Reset Form</button>
      <button class="btn btn-primary" onclick="generatePDF('preview')" style="font-size:0.85rem;padding:14px 32px;">
        Preview Quote
      </button>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<!-- PREVIEW MODAL -->
<div class="preview-modal" id="previewModal">
  <div class="preview-header">
    <div style="color:var(--gold);font-family:var(--font-display);letter-spacing:0.1em;">QUOTE PREVIEW</div>
    <div style="display:flex;gap:1rem;">
      <button class="btn btn-ghost btn-small" onclick="closePreview()">Close</button>
      <button class="btn btn-primary btn-small" onclick="sendQuoteEmail()">Confirm & Send Email</button>
    </div>
  </div>
  <div class="preview-body"><iframe id="previewFrame" class="preview-frame"></iframe></div>
</div>

<script>
// ===== LOGIN =====
const ACCESS_CODE = 'aakaara2026';

function doLogin() {
  const val = document.getElementById('loginPass').value;
  if (val === ACCESS_CODE) {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('app').classList.add('visible');
  } else {
    document.getElementById('loginError').classList.add('show');
    setTimeout(() => document.getElementById('loginError').classList.remove('show'), 2000);
  }
}
document.getElementById('loginPass').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

// ===== SET TODAY'S DATE =====
document.getElementById('quoteDate').valueAsDate = new Date();

// ===== DAY MANAGEMENT =====
let dayCount = 0;

function addDay() {
  dayCount++;
  const div = document.createElement('div');
  div.className = 'day-block';
  div.id = `day-${dayCount}`;
  const dayNum = dayCount;
  div.innerHTML = `
    <div class="day-header">
      <div class="day-title">Day ${dayNum}</div>
      <button class="day-remove" onclick="removeDay(${dayNum})">Remove</button>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Date</label>
        <input class="form-input" type="date" data-field="date">
      </div>
      <div class="form-group">
        <label class="form-label">Total Hours</label>
        <input class="form-input" type="number" data-field="hours" placeholder="e.g. 4" oninput="recalcTotal()">
      </div>
    </div>
    <div class="events-list" id="events-${dayNum}"></div>
    <button class="add-btn" onclick="addEvent(${dayNum})" style="margin-top:0.5rem;">+ Add Event to Day ${dayNum}</button>
  `;
  document.getElementById('daysContainer').appendChild(div);
  addEvent(dayNum);
  recalcTotal();
}

function removeDay(num) {
  const el = document.getElementById(`day-${num}`);
  if (el) el.remove();
  recalcTotal();
}

function addEvent(dayNum) {
  const container = document.getElementById(`events-${dayNum}`);
  if (!container) return;
  const div = document.createElement('div');
  div.className = 'event-item';
  div.innerHTML = `
    <div class="form-group">
      <label class="form-label">Event Name</label>
      <input class="form-input" data-field="eventName" placeholder="e.g. Wedding Ceremony">
    </div>
    <div class="form-group">
      <label class="form-label">Duration</label>
      <input class="form-input" data-field="eventDuration" placeholder="e.g. 2 Hours">
    </div>
    <div class="form-group">
      <label class="form-label">Notes</label>
      <input class="form-input" data-field="eventNotes" placeholder="e.g. Candid & traditional">
    </div>
    <button class="event-remove" onclick="this.parentElement.remove()">&times;</button>
  `;
  container.appendChild(div);
}

// ===== PRICING UI =====
function updatePricingUI() {
  const model = document.getElementById('pricingModel').value;
  document.getElementById('hourlyRateGroup').style.display = model === 'hourly' ? '' : 'none';
  document.getElementById('flatRateGroup').style.display = model === 'flat' ? '' : 'none';

  const showIntro = document.getElementById('showIntro').checked;
  document.getElementById('standardRateGroup').style.display = showIntro ? '' : 'none';

  const travelType = document.getElementById('travelType').value;
  document.getElementById('travelFixedRow').style.display = travelType === 'fixed' ? '' : 'none';

  recalcTotal();
}
document.getElementById('travelType').addEventListener('change', updatePricingUI);

function recalcTotal() {
  const model = document.getElementById('pricingModel').value;
  let total = 0;
  let previewHTML = '';

  if (model === 'hourly') {
    const rate = parseFloat(document.getElementById('hourlyRate').value) || 0;
    // Sum hours from all days
    const dayBlocks = document.querySelectorAll('.day-block');
    let totalHours = 0;
    dayBlocks.forEach((block, i) => {
      const hrs = parseFloat(block.querySelector('[data-field="hours"]').value) || 0;
      const dateInput = block.querySelector('[data-field="date"]');
      const dateStr = dateInput.value ? formatDate(dateInput.value) : `Day ${i+1}`;
      totalHours += hrs;
      if (hrs > 0) {
        previewHTML += `<div class="preview-row"><span class="label">${dateStr}: ${hrs} hrs × $${rate}</span><span class="value">$${(hrs * rate).toLocaleString()}</span></div>`;
      }
    });
    total = totalHours * rate;
    previewHTML += `<div class="preview-row total"><span class="label">Base Total (${totalHours} hours)</span><span class="value">$${total.toLocaleString()}</span></div>`;
  } else {
    total = parseFloat(document.getElementById('flatRate').value) || 0;
    previewHTML = `<div class="preview-row total"><span class="label">Package Price</span><span class="value">$${total.toLocaleString()}</span></div>`;
  }

  const travelType = document.getElementById('travelType').value;
  if (travelType === 'fixed') {
    const travelAmt = parseFloat(document.getElementById('travelAmount').value) || 0;
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value">$${travelAmt.toLocaleString()}</span></div>`;
    total += travelAmt;
  } else if (travelType === 'separate') {
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value" style="color:var(--muted)">Separate</span></div>`;
  } else if (travelType === 'included') {
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value" style="color:var(--gold)">Included</span></div>`;
  }

  document.getElementById('pricingPreview').innerHTML = previewHTML;
  document.getElementById('totalDisplay').textContent = '$' + total.toLocaleString();
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

function formatQuoteDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== RESET =====
function resetForm() {
  if (!confirm('Start a new quote? Current data will be cleared.')) return;
  document.getElementById('clientName').value = '';
  document.getElementById('clientEmail').value = '';
  document.getElementById('location').value = '';
  document.getElementById('quoteDate').valueAsDate = new Date();
  document.getElementById('daysContainer').innerHTML = '';
  dayCount = 0;
  addDay(); // Add Day 1 back
  document.getElementById('editedCount').value = '200';
  document.getElementById('customNotes').value = '';
  document.getElementById('extraNotes').value = '';
  
  // Reset checkboxes to defaults
  document.getElementById('delEdited').checked = true;
  document.getElementById('delRaw').checked = true;
  document.getElementById('delGallery').checked = true;
  const optional = ['delSneakPeek', 'delTeaser', 'delDoc', 'delTraditional', 'delHighlight', 'delDrone', 'delLive', 'delSecondShooter'];
  optional.forEach(id => { if(document.getElementById(id)) document.getElementById(id).checked = false; });

  recalcTotal();
  showToast('Form reset');
}

// ===== PDF GENERATION =====
function generatePDF(action = 'download') {
 try {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'pt', 'letter');
  const W = 612, H = 792;
  const M = 55;

  // Colors
  const GOLD = [201, 149, 107];
  const GOLD_DIM = [160, 120, 86];
  const CREAM = [240, 235, 228];
  const MUTED = [138, 133, 128];
  const DARK_BG = [10, 10, 10];
  const SURFACE = [17, 17, 17];

  // Helpers
  function pageBg() { doc.setFillColor(...DARK_BG); doc.rect(0, 0, W, H, 'F'); }
  function goldLine(x1, y, x2, alpha) {
    doc.setDrawColor(...GOLD); doc.setLineWidth(0.5);
    doc.line(x1, y, x2, y);
  }
  function footerBar() {
    goldLine(M, H - 70, W - M);
    doc.setFontSize(6); doc.setTextColor(...MUTED);
    doc.text('aakaarastudiosnyc.com  |  avala.sudhakar@gmail.com  |  +1 (475) 332-2020', W/2, H - 52, { align: 'center' });
  }
  function headerBar(page, total) {
    doc.setFontSize(6); doc.setTextColor(...GOLD);
    doc.text('A A K A A R A   S T U D I O S', M, 38);
    doc.text(`${String(page).padStart(2,'0')} / ${String(total).padStart(2,'0')}`, W - M, 38, { align: 'right' });
    goldLine(M, 48, W - M);
  }

  // Gather data
  const clientName = document.getElementById('clientName').value || 'Client';
  const eventType = document.getElementById('eventType').value;
  const location = document.getElementById('location').value || 'TBD';
  const quoteDate = document.getElementById('quoteDate').value;
  const quoteDateFormatted = quoteDate ? formatQuoteDate(quoteDate) : 'N/A';
  const model = document.getElementById('pricingModel').value;
  const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 0;
  const flatRate = parseFloat(document.getElementById('flatRate').value) || 0;
  const travelType = document.getElementById('travelType').value;
  const showIntro = document.getElementById('showIntro').checked;
  const standardRate = document.getElementById('standardRate').value;
  const editedCount = document.getElementById('editedCount').value || '200';
  const timeline = document.getElementById('timeline').value || '6-8 weeks';
  const deposit = document.getElementById('deposit').value;
  const validity = document.getElementById('validity').value || '30 days';

  // Gather days
  const days = [];
  document.querySelectorAll('.day-block').forEach((block, i) => {
    const date = block.querySelector('[data-field="date"]').value;
    const hours = block.querySelector('[data-field="hours"]').value;
    const events = [];
    block.querySelectorAll('.event-item').forEach(ev => {
      const name = ev.querySelector('[data-field="eventName"]').value;
      const dur = ev.querySelector('[data-field="eventDuration"]').value;
      const notes = ev.querySelector('[data-field="eventNotes"]').value;
      if (name) events.push({ name, dur, notes });
    });
    days.push({ date, hours, events });
  });

  const totalHours = days.reduce((s, d) => s + (parseFloat(d.hours) || 0), 0);
  const totalPages = 4;

  // Deliverables
  const dels = [];
  if (document.getElementById('delEdited').checked) dels.push('Edited photos with professional color grading');
  if (document.getElementById('delRaw').checked) dels.push('All raw images delivered');
  if (document.getElementById('delGallery').checked) dels.push('Online gallery for viewing and downloads');
  if (document.getElementById('delSneakPeek').checked) dels.push('Same-day sneak peek reels (24hr delivery)');
  if (document.getElementById('delTeaser').checked) dels.push('Wedding Teaser (2-3 minutes) — all event highlights');
  if (document.getElementById('delDoc').checked) dels.push('Documentary Film (10 min) — interviews with couple, parents & friends');
  if (document.getElementById('delTraditional').checked) dels.push('Traditional Video Coverage (Full length)');
  if (document.getElementById('delHighlight').checked) dels.push('Highlight Video (2-3 minutes)');
  if (document.getElementById('delDrone').checked) dels.push('Drone Footage — included where permitted');
  if (document.getElementById('delLive').checked) dels.push('Live Wedding Coverage (venue must provide internet)');
  if (document.getElementById('delSecondShooter').checked) dels.push('Second Photographer (Full Coverage)');

  // ===== PAGE 1 — COVER =====
  pageBg();
  goldLine(M, 45, W - M);

  // Logo text
  doc.setFontSize(8); doc.setTextColor(...GOLD);
  doc.text('A A K A A R A   S T U D I O S', W/2, 145, { align: 'center' });
  doc.setFontSize(6); doc.setTextColor(...MUTED);
  doc.text('N E W   Y O R K   C I T Y', W/2, 158, { align: 'center' });

  // Title
  const titleWords = eventType.replace(' Photography', '').split(' ');
  doc.setFont('times', 'normal');
  doc.setFontSize(32); doc.setTextColor(...CREAM);
  doc.text(titleWords.join(' '), W/2, 240, { align: 'center' });
  doc.text('Photography', W/2, 275, { align: 'center' });

  doc.setFont('helvetica', 'normal');
  doc.setFontSize(9); doc.setTextColor(...GOLD);
  doc.text('— Professional Coverage Proposal —', W/2, 303, { align: 'center' });
  goldLine(W/2 - 55, 322, W/2 + 55);

  // Prepared For
  doc.setFont('times', 'italic');
  doc.setFontSize(10); doc.setTextColor(...CREAM);
  doc.text('Prepared for', W/2, 350, { align: 'center' });
  doc.setFont('times', 'normal');
  doc.setFontSize(22); doc.setTextColor(...GOLD);
  doc.text(clientName, W/2, 380, { align: 'center' });

  // Event details on cover
  let y = 420;
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('EVENT DETAILS', M, y);
  y += 22;

  const coverDetails = [
    ['Client', clientName],
    ['Location', location],
  ];
  if (days.length === 1) {
    coverDetails.push(['Date', days[0].date ? formatDate(days[0].date) : 'TBD']);
    coverDetails.push(['Duration', (days[0].hours || '0') + ' Hours']);
  } else if (days.length > 1) {
    days.forEach((d, i) => {
      coverDetails.push([`Day ${i+1}`, (d.date ? formatDate(d.date) : 'TBD') + '  —  ' + (d.hours || '0') + ' Hours']);
    });
    coverDetails.push(['Total Coverage', totalHours + ' Hours across ' + days.length + ' Days']);
  }

  coverDetails.forEach(([label, value]) => {
    doc.setFillColor(17, 17, 17);
    doc.roundedRect(M, y - 10, W - 2*M, 20, 3, 3, 'F');
    doc.setFontSize(7); doc.setTextColor(...MUTED);
    doc.text(label, M + 12, y + 2);
    doc.setFontSize(8); doc.setTextColor(...CREAM);
    doc.text(value, W - M - 12, y + 2, { align: 'right' });
    y += 26;
  });

  doc.setFontSize(6); doc.setTextColor(...MUTED);
  doc.text('Quote Date: ' + quoteDateFormatted, W/2, y + 12, { align: 'center' });

  footerBar();

  // ===== PAGE 2 — SCHEDULE + SCOPE =====
  doc.addPage();
  pageBg();
  headerBar(2, totalPages);

  y = 78;

  // Day-by-day schedule
  days.forEach((day, di) => {
    doc.setFontSize(6); doc.setTextColor(...GOLD);
    doc.text(`DAY ${di+1}  —  ${day.date ? formatDate(day.date).toUpperCase() : 'TBD'}`, M, y);
    y += 18;

    day.events.forEach(ev => {
      doc.setFillColor(17, 17, 17);
      doc.roundedRect(M, y - 10, W - 2*M, 28, 3, 3, 'F');
      doc.setFontSize(9); doc.setTextColor(...CREAM);
      doc.text(ev.name, M + 12, y + 2);
      if (ev.notes) {
        doc.setFontSize(6.5); doc.setTextColor(...MUTED);
        doc.text(ev.notes, M + 12, y + 12);
      }
      if (ev.dur) {
        doc.setFontSize(7.5); doc.setTextColor(...GOLD);
        doc.text(ev.dur, W - M - 12, y + 2, { align: 'right' });
      }
      y += 34;
    });

    // Day total
    doc.setFillColor(30, 26, 22);
    doc.roundedRect(M, y - 10, W - 2*M, 20, 3, 3, 'F');
    doc.setFontSize(7.5); doc.setTextColor(...GOLD);
    doc.text(`Day ${di+1} Total`, M + 12, y + 2);
    doc.text((day.hours || '0') + ' Hours', W - M - 12, y + 2, { align: 'right' });
    y += 35;
  });

  // Scope
  y += 8;
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('SCOPE OF COVERAGE', M, y);
  y += 20;

  dels.forEach(item => {
    doc.setFillColor(...GOLD);
    doc.circle(M + 7, y - 1, 1.5, 'F');
    doc.setFontSize(7.5); doc.setTextColor(...CREAM);
    doc.text(item, M + 16, y);
    y += 16;
  });

  // Live wedding highlight if checked
  if (document.getElementById('delLive').checked) {
    y += 5;
    doc.setFillColor(30, 26, 22);
    doc.roundedRect(M, y - 10, W - 2*M, 35, 4, 4, 'F');
    doc.setDrawColor(...GOLD); doc.setLineWidth(0.8);
    doc.roundedRect(M, y - 10, W - 2*M, 35, 4, 4, 'S');
    doc.setFontSize(5.5); doc.setTextColor(...GOLD);
    doc.text('★  HIGHLIGHTED', M + 12, y + 2);
    doc.setFontSize(9); doc.setTextColor(...CREAM);
    doc.text('Live Wedding Coverage', M + 12, y + 14);
    doc.setFontSize(7); doc.setTextColor(...MUTED);
    doc.text('Included for the wedding ceremony (venue must provide internet)', M + 155, y + 14);
  }

  footerBar();

  // ===== PAGE 3 — DELIVERABLES + INVESTMENT =====
  doc.addPage();
  pageBg();
  headerBar(3, totalPages);

  y = 78;

  // Photo deliverables
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('DELIVERABLES SUMMARY', M, y);
  y += 20;

  doc.setFillColor(21, 21, 21);
  doc.roundedRect(M, y - 8, W - 2*M, 18, 3, 3, 'F');
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('ITEM', M + 12, y + 2);
  doc.text('DETAILS', W - M - 12, y + 2, { align: 'right' });
  y += 22;

  const delItems = [];
  if (document.getElementById('delEdited').checked) delItems.push(['Edited Photos', editedCount + ' photos']);
  if (document.getElementById('delRaw').checked) delItems.push(['Raw Images', 'Full gallery delivered']);
  if (document.getElementById('delGallery').checked) delItems.push(['Online Gallery', 'Private link for viewing & downloads']);
  if (document.getElementById('delSneakPeek').checked) delItems.push(['Sneak Peek Reels', '24-hour delivery']);
  if (document.getElementById('delTeaser').checked) delItems.push(['Wedding Teaser', '2-3 minute highlight reel']);
  if (document.getElementById('delDoc').checked) delItems.push(['Documentary Film', '10 min with interviews']);
  if (document.getElementById('delTraditional').checked) delItems.push(['Traditional Video', 'Full length coverage']);
  if (document.getElementById('delHighlight').checked) delItems.push(['Highlight Video', '2-3 minute cinematic edit']);
  if (document.getElementById('delDrone').checked) delItems.push(['Drone Footage', 'Where permitted']);
  if (document.getElementById('delLive').checked) delItems.push(['Live Coverage', 'Venue internet required']);
  if (document.getElementById('delSecondShooter').checked) delItems.push(['Second Shooter', 'Full coverage']);

  delItems.forEach(([item, detail]) => {
    doc.setFontSize(8); doc.setTextColor(...CREAM);
    doc.text(item, M + 12, y);
    doc.setFontSize(7.5); doc.setTextColor(...MUTED);
    doc.text(detail, W - M - 12, y, { align: 'right' });
    y += 20;
  });

  // Investment
  y += 15;
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('INVESTMENT', M, y);
  y += 20;

  // Price box
  const boxH = 72;
  doc.setFillColor(17, 17, 17);
  doc.roundedRect(M, y - 8, W - 2*M, boxH, 4, 4, 'F');
  doc.setDrawColor(...GOLD); doc.setLineWidth(0.4);
  doc.roundedRect(M, y - 8, W - 2*M, boxH, 4, 4, 'S');

  if (showIntro) {
    doc.setFillColor(30, 26, 22);
    doc.roundedRect(M + 15, y - 2, 100, 13, 6, 6, 'F');
    doc.setFontSize(5.5); doc.setTextColor(...GOLD);
    doc.text('INTRODUCTORY RATE', M + 65, y + 7, { align: 'center' });
  }

  if (model === 'hourly') {
    doc.setFontSize(6); doc.setTextColor(...MUTED);
    doc.text('HOURLY RATE', M + 15, y + (showIntro ? 20 : 8));
    doc.setFontSize(32); doc.setTextColor(...CREAM);
    doc.text('$' + hourlyRate, M + 15, y + (showIntro ? 46 : 36));
    doc.setFontSize(9); doc.setTextColor(...MUTED);
    doc.text('/ hour', M + 90, y + (showIntro ? 42 : 32));

    // Breakdown on right
    doc.setFontSize(6); doc.setTextColor(...MUTED);
    doc.text('BREAKDOWN', W/2 + 10, y + (showIntro ? 20 : 8));
    let by = y + (showIntro ? 32 : 20);
    let baseTotal = 0;
    days.forEach((d, i) => {
      const hrs = parseFloat(d.hours) || 0;
      const amt = hrs * hourlyRate;
      baseTotal += amt;
      doc.setFontSize(7.5); doc.setTextColor(...CREAM);
      doc.text(`Day ${i+1}: ${hrs} hrs × $${hourlyRate}`, W/2 + 10, by);
      doc.setTextColor(...GOLD);
      doc.text('$' + amt.toLocaleString(), W - M - 15, by, { align: 'right' });
      by += 14;
    });
    goldLine(W/2 + 10, by - 4, W - M - 15);
    doc.setFontSize(9); doc.setTextColor(...CREAM);
    doc.text('Base Total', W/2 + 10, by + 6);
    doc.setTextColor(...GOLD);
    doc.text('$' + baseTotal.toLocaleString(), W - M - 15, by + 6, { align: 'right' });
  } else {
    doc.setFontSize(6); doc.setTextColor(...MUTED);
    doc.text('PACKAGE PRICE', M + 15, y + (showIntro ? 20 : 8));
    doc.setFontSize(32); doc.setTextColor(...CREAM);
    doc.text('$' + flatRate.toLocaleString(), M + 15, y + (showIntro ? 46 : 36));
    doc.setFontSize(8); doc.setTextColor(...MUTED);
    doc.text('All-inclusive package', W/2 + 10, y + (showIntro ? 30 : 20));
  }

  if (showIntro && standardRate) {
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    const srText = 'Standard rate: ' + standardRate;
    doc.text(srText, M + 15, y + boxH - 10);
    const srWidth = doc.getTextWidth(srText);
    doc.setDrawColor(...MUTED); doc.setLineWidth(0.4);
    doc.line(M + 15, y + boxH - 13, M + 15 + srWidth, y + boxH - 13);
  }

  y += boxH + 10;

  // Travel
  if (travelType === 'separate') {
    doc.setFillColor(17, 17, 17);
    doc.roundedRect(M, y - 4, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(7); doc.setTextColor(...MUTED);
    doc.text('TRAVEL & ACCOMMODATION', M + 12, y + 8);
    doc.setFontSize(8); doc.setTextColor(...CREAM);
    doc.text('Calculated separately', W - M - 12, y + 8, { align: 'right' });
    y += 30;
  } else if (travelType === 'fixed') {
    const tAmt = parseFloat(document.getElementById('travelAmount').value) || 0;
    doc.setFillColor(17, 17, 17);
    doc.roundedRect(M, y - 4, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(7); doc.setTextColor(...MUTED);
    doc.text('TRAVEL & ACCOMMODATION', M + 12, y + 8);
    doc.setFontSize(8); doc.setTextColor(...GOLD);
    doc.text('$' + tAmt.toLocaleString(), W - M - 12, y + 8, { align: 'right' });
    y += 30;
  }

  // Additional info
  doc.setFontSize(6); doc.setTextColor(...GOLD);
  doc.text('ADDITIONAL INFORMATION', M, y);
  y += 15;

  const addInfo = [
    ['Deposit', deposit],
    ['Timeline', 'Final deliverables within ' + timeline],
  ];
  const extraNotes = document.getElementById('extraNotes').value;
  if (extraNotes) {
    extraNotes.split('\n').forEach(line => {
      if (line.trim()) {
        const parts = line.split(':');
        if (parts.length > 1) {
          addInfo.push([parts[0].trim(), parts.slice(1).join(':').trim()]);
        } else {
          addInfo.push(['Note', line.trim()]);
        }
      }
    });
  }

  addInfo.forEach(([label, detail]) => {
    doc.setFontSize(7); doc.setTextColor(...CREAM);
    doc.text(label, M + 8, y);
    doc.setTextColor(...MUTED);
    doc.text(detail, M + 110, y);
    y += 13;
  });

  // Validity
  y += 8;
  doc.setFillColor(30, 26, 22);
  doc.roundedRect(M, y - 6, W - 2*M, 18, 3, 3, 'F');
  doc.setFontSize(7); doc.setTextColor(...CREAM);
  doc.text('This quote is valid for ' + validity + ' from the date above.', W/2, y + 4, { align: 'center' });

  footerBar();

  // ===== PAGE 4 — CLOSING =====
  doc.addPage();
  pageBg();
  headerBar(4, totalPages);

  y = 220;
  const firstName = clientName.split('&')[0].split(' ')[0].trim().replace(/,/g, '');
  
  doc.setFont('times', 'normal');
  doc.setFontSize(12); doc.setTextColor(...CREAM);
  doc.text(`${firstName}, thank you for trusting us with your story.`, W/2, y, { align: 'center' });
  y += 24;
  doc.setFontSize(10); doc.setTextColor(...MUTED);
  doc.text("We don't just photograph moments — we preserve the emotions within them.", W/2, y, { align: 'center' });
  y += 16;
  doc.text("It would be an honor to be part of your celebration.", W/2, y, { align: 'center' });

  y += 40;
  doc.setFont('times', 'italic');
  doc.setFontSize(11); doc.setTextColor(...GOLD);
  doc.text("With warmth,", W/2, y, { align: 'center' });
  y += 20;
  doc.setFont('times', 'normal');
  doc.setFontSize(14); doc.setTextColor(...CREAM);
  doc.text("Sudhakar Avula", W/2, y, { align: 'center' });
  y += 14;
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(7); doc.setTextColor(...MUTED);
  doc.text("Founder & Lead Photographer, Aakaara Studios", W/2, y, { align: 'center' });

  y = H - 100;
  doc.setFont('times', 'italic');
  doc.setFontSize(9); doc.setTextColor(...GOLD_DIM);
  doc.text("Every story deserves its own canvas.", W/2, y, { align: 'center' });

  footerBar();

  // Save
  const safeName = clientName.replace(/[^a-zA-Z0-9]/g, '_');
  
  if (action === 'preview') {
    const blob = doc.output('blob');
    const url = URL.createObjectURL(blob);
    document.getElementById('previewFrame').src = url;
    document.getElementById('previewModal').classList.add('show');
  } else {
    doc.save(`Aakaara_Studios_Quote_${safeName}.pdf`);
    showToast('PDF generated & downloading!');
  }
 } catch (err) {
   console.error(err);
   alert('Error generating PDF: ' + err.message);
 }
}

function closePreview() {
  document.getElementById('previewModal').classList.remove('show');
}

function sendQuoteEmail() {
  const email = document.getElementById('clientEmail').value;
  const name = document.getElementById('clientName').value;
  
  if (!email) {
    alert('Please enter a Client Email address in the form first.');
    closePreview();
    document.getElementById('clientEmail').focus();
    return;
  }

  // 1. Download the PDF so the user has it to attach
  generatePDF('download');

  // 2. Construct email
  const subject = `Photography Quote: ${name} — Aakaara Studios`;
  const body = `Hi ${name.split(' ')[0]},\n\nIt was wonderful connecting with you. Please find the attached quote for your photography coverage.\n\nWe've customized this based on our discussion. Let us know if you have any questions!\n\nBest,\nSudhakar Avula\nAakaara Studios NYC`;
  
  // 3. Open Gmail Compose (Forces Google Workspace/Gmail)
  const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(email)}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  
  setTimeout(() => {
    window.open(gmailUrl, '_blank');
    showToast('Quote downloaded. Please attach it to the Gmail tab!');
  }, 800);
}

// Init with one day
addDay();
recalcTotal();

// Listen for changes
document.addEventListener('input', recalcTotal);
</script>

</body>
</html>