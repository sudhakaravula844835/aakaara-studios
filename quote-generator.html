<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aakaara Studios — Quote Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<link rel="stylesheet" href="https://use.typekit.net/uyl0arj.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=DM+Sans:wght@300;400;500;600;700&display=swap');

:root {
  --bg: #0a0a0a;
  --surface: #111111;
  --surface2: #1a1a1a;
  --gold: #c9956b;
  --gold-dim: rgba(201,149,107,0.15);
  --gold-border: rgba(201,149,107,0.25);
  --cream: #f0ebe4;
  --muted: #8a8580;
  --dark: #1e1a16;
  --font-display: 'Cormorant Garamond', serif;
  --font-body: 'DM Sans', sans-serif;
  --ease: cubic-bezier(0.16, 1, 0.3, 1);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { -webkit-font-smoothing: antialiased; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--cream);
  min-height: 100vh;
  overflow-x: hidden;
}

/* === LOGIN SCREEN === */
.login-screen {
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  background: var(--bg);
  transition: opacity 0.6s var(--ease), visibility 0.6s;
}
.login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.login-box {
  text-align: center; width: 320px;
}
.login-box .logo-text {
  font-family: var(--font-display); font-size: 1.1rem;
  letter-spacing: 0.3em; color: var(--gold); margin-bottom: 0.3rem;
}
.login-box .logo-sub {
  font-size: 0.55rem; letter-spacing: 0.25em; color: var(--muted); margin-bottom: 2.5rem;
}
.login-box input {
  width: 100%; padding: 14px 18px;
  background: var(--surface); border: 1px solid var(--gold-border);
  border-radius: 8px; color: var(--cream); font-size: 0.85rem;
  font-family: var(--font-body); outline: none;
  transition: border-color 0.3s;
  text-align: center; letter-spacing: 0.15em;
}
.login-box input:focus { border-color: var(--gold); }
.login-box input::placeholder { color: var(--muted); letter-spacing: 0.1em; }
.login-error {
  font-size: 0.7rem; color: #e06050; margin-top: 0.8rem;
  opacity: 0; transition: opacity 0.3s;
}
.login-error.show { opacity: 1; }

/* === MAIN APP === */
.app { display: none; }
.app.visible { display: block; }

/* Top bar */
.topbar {
  position: sticky; top: 0; z-index: 100;
  padding: 1rem 2rem;
  display: flex; align-items: center; justify-content: space-between;
  background: rgba(10,10,10,0.85);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(201,149,107,0.1);
}
.topbar-brand {
  font-family: var(--font-display); font-size: 0.9rem;
  letter-spacing: 0.25em; color: var(--gold);
}
.topbar-title {
  font-size: 0.65rem; letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase;
}
.topbar-actions { display: flex; gap: 0.8rem; }

/* Buttons */
.btn {
  padding: 10px 22px; border-radius: 6px; border: none;
  font-family: var(--font-body); font-size: 0.75rem;
  letter-spacing: 0.08em; cursor: pointer;
  transition: all 0.3s var(--ease); font-weight: 500;
}
.btn-primary {
  background: var(--gold); color: var(--dark);
}
.btn-primary:hover { background: #d4a57a; transform: translateY(-1px); }
.btn-ghost {
  background: transparent; color: var(--cream);
  border: 1px solid rgba(255,255,255,0.15);
}
.btn-ghost:hover { border-color: var(--gold); color: var(--gold); }
.btn-danger {
  background: transparent; color: #e06050;
  border: 1px solid rgba(224,96,80,0.3);
}
.btn-danger:hover { background: rgba(224,96,80,0.1); }
.btn-small { padding: 6px 14px; font-size: 0.7rem; }

/* Layout */
.container {
  max-width: 900px; margin: 0 auto;
  padding: 2rem 2rem 4rem;
}

/* Sections */
.section {
  background: var(--surface);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 1.8rem;
  margin-bottom: 1.2rem;
}
.section-label {
  font-size: 0.6rem; letter-spacing: 0.25em; color: var(--gold);
  text-transform: uppercase; margin-bottom: 1.2rem;
  display: flex; align-items: center; gap: 0.5rem;
}
.section-label::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, var(--gold-border), transparent);
}

/* Form elements */
.form-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
  margin-bottom: 1rem;
}
.form-row.three { grid-template-columns: 1fr 1fr 1fr; }
.form-row.single { grid-template-columns: 1fr; }
.form-group { display: flex; flex-direction: column; gap: 0.4rem; }
.form-label {
  font-size: 0.65rem; letter-spacing: 0.1em; color: var(--muted);
  text-transform: uppercase;
}
.form-input, .form-select, .form-textarea {
  padding: 11px 14px;
  background: var(--surface2); border: 1px solid rgba(255,255,255,0.08);
  border-radius: 6px; color: var(--cream); font-size: 0.85rem;
  font-family: var(--font-body); outline: none;
  transition: border-color 0.3s;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  border-color: var(--gold);
}
.form-input::placeholder { color: rgba(138,133,128,0.5); }
.form-select {
  cursor: pointer;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238a8580' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}
.form-select option { background: var(--surface2); color: var(--cream); }
.form-textarea { resize: vertical; min-height: 70px; }
.form-checkbox {
  display: flex; align-items: center; gap: 0.6rem; cursor: pointer;
}
.form-checkbox input[type="checkbox"] {
  width: 16px; height: 16px; accent-color: var(--gold); cursor: pointer;
}
.form-checkbox span { font-size: 0.8rem; color: var(--cream); }

/* Event days */
.day-block {
  background: var(--surface2); border-radius: 8px;
  padding: 1.2rem; margin-bottom: 1rem;
  border: 1px solid rgba(255,255,255,0.04);
}
.day-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1rem;
}
.day-title {
  font-family: var(--font-display); font-size: 1rem;
  color: var(--cream); font-weight: 500;
}
.day-remove {
  background: none; border: none; color: var(--muted);
  cursor: pointer; font-size: 0.7rem; padding: 4px 10px;
  border-radius: 4px; transition: all 0.2s;
}
.day-remove:hover { color: #e06050; background: rgba(224,96,80,0.1); }

/* Event items within a day */
.event-item {
  display: grid; grid-template-columns: 2fr 1fr 2fr 30px; gap: 0.8rem;
  align-items: end; margin-bottom: 0.8rem;
}
.event-remove {
  background: none; border: none; color: var(--muted);
  cursor: pointer; font-size: 1rem; padding: 8px 0;
  transition: color 0.2s;
}
.event-remove:hover { color: #e06050; }
.add-btn {
  width: 100%; padding: 8px;
  background: transparent; border: 1px dashed rgba(201,149,107,0.3);
  border-radius: 6px; color: var(--gold); font-size: 0.75rem;
  font-family: var(--font-body); cursor: pointer;
  transition: all 0.3s;
}
.add-btn:hover { background: var(--gold-dim); border-color: var(--gold); }

/* Deliverable checkboxes */
.deliverables-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem;
}

/* Pricing badge */
.pricing-badge {
  display: inline-flex; align-items: center; gap: 0.4rem;
  padding: 4px 12px; border-radius: 20px;
  background: var(--gold-dim); border: 1px solid var(--gold-border);
  font-size: 0.65rem; color: var(--gold); letter-spacing: 0.1em;
}

/* Preview card */
.preview-summary {
  background: var(--surface2); border-radius: 8px;
  padding: 1.2rem; margin-top: 1rem;
}
.preview-row {
  display: flex; justify-content: space-between;
  padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 0.8rem;
}
.preview-row:last-child { border: none; }
.preview-row .label { color: var(--muted); }
.preview-row .value { color: var(--cream); font-weight: 500; }
.preview-row.total { border-top: 1px solid var(--gold-border); padding-top: 0.8rem; margin-top: 0.3rem; }
.preview-row.total .value { color: var(--gold); font-size: 1.1rem; font-weight: 700; }

/* Generate bar */
.generate-bar {
  position: sticky; bottom: 0;
  padding: 1rem 2rem;
  background: rgba(10,10,10,0.9);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(201,149,107,0.1);
  display: flex; align-items: center; justify-content: space-between;
}
.generate-bar .total-display {
  font-family: var(--font-display); font-size: 1.8rem;
  color: var(--cream); font-weight: 400;
}
.generate-bar .total-label {
  font-size: 0.6rem; letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase;
}

/* Toast */
.toast {
  position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
  padding: 12px 24px; border-radius: 8px;
  background: var(--gold); color: var(--dark);
  font-size: 0.8rem; font-weight: 500;
  opacity: 0; transition: all 0.4s var(--ease);
  pointer-events: none; z-index: 200;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Preview Modal */
.preview-modal {
  position: fixed; inset: 0; z-index: 2000;
  background: rgba(0,0,0,0.95);
  display: flex; flex-direction: column;
  opacity: 0; visibility: hidden; transition: all 0.3s;
}
.preview-modal.show { opacity: 1; visibility: visible; }
.preview-header {
  padding: 1rem 2rem; background: var(--surface);
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.preview-body { flex: 1; width: 100%; height: 100%; overflow: hidden; }
.preview-frame { width: 100%; height: 100%; border: none; }

/* Responsive */
@media (max-width: 600px) {
  .form-row { grid-template-columns: 1fr; }
  .form-row.three { grid-template-columns: 1fr; }
  .event-item { grid-template-columns: 1fr; }
  .deliverables-grid { grid-template-columns: 1fr; }
  .container { padding: 1rem; }
  .topbar { padding: 0.8rem 1rem; }
  .generate-bar { padding: 0.8rem 1rem; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="logo-text">Aakaara Studios</div>
    <div class="logo-sub">QUOTE GENERATOR</div>
    <input type="password" id="loginPass" placeholder="Enter access code" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="btn btn-primary btn-small" onclick="doLogin()" style="margin-top:1rem;width:100%;">ENTER</button>
    <div class="login-error" id="loginError">Incorrect access code</div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">

  <!-- Top bar -->
  <div class="topbar">
    <div>
      <div class="topbar-brand">Aakaara Studios</div>
      <div class="topbar-title">Quote Generator</div>
    </div>
    <div class="topbar-actions">
      <button class="btn btn-ghost btn-small" onclick="resetForm()">New Quote</button>
    </div>
  </div>

  <div class="container">

    <!-- CLIENT INFO -->
    <div class="section">
      <div class="section-label">Client Information</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Client Name(s)</label>
          <input class="form-input" id="clientName" placeholder="e.g. Asrita & Varun">
        </div>
        <div class="form-group">
          <label class="form-label">Client Email</label>
          <input class="form-input" type="email" id="clientEmail" placeholder="client@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Event Type</label>
          <select class="form-select" id="eventType">
            <option value="Wedding Photography">Wedding</option>
            <option value="Engagement Photography">Engagement</option>
            <option value="Gender Reveal Photography">Gender Reveal</option>
            <option value="Birthday Photography">Birthday</option>
            <option value="Baby Shower Photography">Baby Shower</option>
            <option value="House Warming Photography">House Warming</option>
            <option value="Event Photography">Other Event</option>
          </select>
        </div>
      </div>
      <div class="form-row three">
        <div class="form-group">
          <label class="form-label">Location</label>
          <input class="form-input" id="location" placeholder="e.g. San Antonio, Texas">
        </div>
        <div class="form-group">
          <label class="form-label">Client Phone</label>
          <input class="form-input" type="tel" id="clientPhone" placeholder="e.g. (555) 123-4567">
        </div>
        <div class="form-group">
          <label class="form-label">Quote Date</label>
          <input class="form-input" type="date" id="quoteDate">
        </div>
      </div>
    </div>

    <!-- EVENT DAYS -->
    <div class="section">
      <div class="section-label">Event Schedule</div>
      <div id="daysContainer"></div>
      <button class="add-btn" id="addDayBtn" onclick="addDay()">+ Add Day</button>
    </div>

    <!-- DELIVERABLES -->
    <div class="section">
      <div class="section-label">Deliverables</div>
      <div class="deliverables-grid">
        <label class="form-checkbox"><input type="checkbox" id="delEdited" checked><span>Edited Photos</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delRaw" checked><span>Raw Images</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delGallery" checked><span>Online Gallery</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delSneakPeek"><span>Sneak Peek Reels</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delTeaser"><span>Wedding Teaser (2-3 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delDoc"><span>Documentary Film (10 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delTraditional"><span>Traditional Video (Full)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delHighlight"><span>Highlight Video (2-3 min)</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delDrone"><span>Drone Footage</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delLive"><span>Live Wedding Coverage</span></label>
        <label class="form-checkbox"><input type="checkbox" id="delSecondShooter"><span>Second Shooter</span></label>
      </div>
      <div class="form-row" style="margin-top:1rem;">
        <div class="form-group">
          <label class="form-label">Total Edited Photos</label>
          <input class="form-input" type="number" id="editedCount" placeholder="e.g. 500" value="200">
        </div>
        <div class="form-group">
          <label class="form-label">Delivery Timeline</label>
          <input class="form-input" id="timeline" placeholder="e.g. 6-8 weeks" value="6-8 weeks">
        </div>
      </div>
      <div class="form-row single" style="margin-top:0.5rem;">
        <div class="form-group">
          <label class="form-label">Custom Deliverable Notes (optional)</label>
          <textarea class="form-textarea" id="customNotes" placeholder="Any extra notes about deliverables..."></textarea>
        </div>
      </div>
    </div>

    <!-- PRICING -->
    <div class="section">
      <div class="section-label">Pricing</div>
      <div class="form-row three">
        <div class="form-group">
          <label class="form-label">Pricing Model</label>
          <select class="form-select" id="pricingModel" onchange="updatePricingUI()">
            <option value="hourly">Hourly Rate</option>
            <option value="flat">Flat Package</option>
          </select>
        </div>
        <div class="form-group" id="hourlyRateGroup">
          <label class="form-label">Hourly Rate ($)</label>
          <input class="form-input" type="number" id="hourlyRate" value="300">
        </div>
        <div class="form-group" id="flatRateGroup" style="display:none;">
          <label class="form-label">Package Price ($)</label>
          <input class="form-input" type="number" id="flatRate" placeholder="e.g. 1200">
        </div>
        <div class="form-group">
          <label class="form-label">Travel & Accommodation</label>
          <select class="form-select" id="travelType">
            <option value="separate">Calculated Separately</option>
            <option value="included">Included in Price</option>
            <option value="fixed">Fixed Amount</option>
            <option value="none">N/A (Local)</option>
          </select>
        </div>
      </div>
      <div class="form-row" id="travelFixedRow" style="display:none;">
        <div class="form-group">
          <label class="form-label">Travel Amount ($)</label>
          <input class="form-input" type="number" id="travelAmount" placeholder="e.g. 500">
        </div>
      </div>
      <div class="form-row">
        <label class="form-checkbox">
          <input type="checkbox" id="showIntro" onchange="updatePricingUI()">
          <span>Show as Introductory/Special Rate</span>
        </label>
        <div class="form-group" id="standardRateGroup" style="display:none;">
          <label class="form-label">Standard Rate (strikethrough)</label>
          <input class="form-input" id="standardRate" placeholder="e.g. $1,200">
        </div>
      </div>

      <!-- Live preview -->
      <div class="preview-summary" id="pricingPreview"></div>
    </div>

    <!-- ADDITIONAL NOTES -->
    <div class="section">
      <div class="section-label">Additional Terms</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Deposit Requirement</label>
          <input class="form-input" id="deposit" value="50% deposit required to secure dates">
        </div>
        <div class="form-group">
          <label class="form-label">Quote Validity</label>
          <input class="form-input" id="validity" value="30 days">
        </div>
      </div>
      <div class="form-row single">
        <div class="form-group">
          <label class="form-label">Extra Notes (optional)</label>
          <textarea class="form-textarea" id="extraNotes" placeholder="e.g. Multi-day discount applied, package can be customized..."></textarea>
        </div>
      </div>
      <div class="form-row single" style="margin-top:0.8rem;">
        <label style="display:flex;align-items:center;gap:0.6rem;cursor:pointer;font-size:0.8rem;color:var(--muted);">
          <input type="checkbox" id="termsCheck" style="accent-color:var(--gold);width:16px;height:16px;">
          I approve this quote & terms
        </label>
      </div>
    </div>

  </div>

  <!-- Sticky generate bar -->
  <div class="generate-bar">
    <div>
      <div class="total-label">Estimated Total</div>
      <div class="total-display" id="totalDisplay">$0</div>
    </div>
    <div style="display:flex;gap:0.8rem;">
      <button class="btn btn-danger" onclick="resetForm()" style="font-size:0.85rem;padding:14px 20px;">Reset Form</button>
      <button class="btn btn-primary" onclick="generatePDF('preview')" style="font-size:0.85rem;padding:14px 32px;">
        Generate PDF Quote
      </button>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<!-- Preview Modal -->
<div class="preview-modal" id="previewModal">
  <div class="preview-header">
    <span style="font-family:var(--font-display);font-size:1rem;letter-spacing:0.15em;color:var(--gold);">QUOTE PREVIEW</span>
    <div style="display:flex;gap:0.6rem;">
      <button class="btn btn-primary btn-small" onclick="downloadFromPreview()" style="font-size:0.75rem;padding:8px 16px;">Download PDF</button>
      <button class="btn btn-primary btn-small" onclick="sendToClient()" style="font-size:0.75rem;padding:8px 16px;background:var(--gold);color:var(--dark);">Send to Client</button>
      <button class="btn btn-danger btn-small" onclick="closePreviewModal()" style="font-size:0.75rem;padding:8px 16px;">Close</button>
    </div>
  </div>
  <div class="preview-body">
    <iframe class="preview-frame" id="previewFrame"></iframe>
  </div>
</div>

<script>
// ===== LOGIN =====
const ACCESS_CODE = 'aakaara2026';

function doLogin() {
  const val = document.getElementById('loginPass').value.trim();
  if (val === ACCESS_CODE) {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('app').classList.add('visible');
  } else {
    document.getElementById('loginError').classList.add('show');
    setTimeout(() => document.getElementById('loginError').classList.remove('show'), 2000);
  }
}
document.getElementById('loginPass').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

// ===== SET TODAY'S DATE =====
document.getElementById('quoteDate').valueAsDate = new Date();

// ===== DAY MANAGEMENT =====
let dayCount = 0;

function isWeddingEvent() {
  return document.getElementById('eventType').value === 'Wedding Photography';
}

function calcHoursFromTime(fromStr, toStr) {
  if (!fromStr || !toStr) return 0;
  const [fH, fM] = fromStr.split(':').map(Number);
  const [tH, tM] = toStr.split(':').map(Number);
  let diff = (tH * 60 + tM) - (fH * 60 + fM);
  if (diff < 0) diff += 24 * 60;
  return Math.round(diff / 30) / 2;
}

function formatTime12(timeStr) {
  if (!timeStr) return '';
  const [h, m] = timeStr.split(':').map(Number);
  const ampm = h >= 12 ? 'PM' : 'AM';
  const hr = h % 12 || 12;
  return hr + ':' + String(m).padStart(2, '0') + ' ' + ampm;
}

function addDay() {
  dayCount++;
  const div = document.createElement('div');
  div.className = 'day-block';
  div.id = `day-${dayCount}`;
  const dayNum = dayCount;
  const wedding = isWeddingEvent();

  if (wedding) {
    div.innerHTML = `
      <div class="day-header">
        <div class="day-title">Day ${dayNum}</div>
        <button class="day-remove" onclick="removeDay(${dayNum})">Remove</button>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Date</label>
          <input class="form-input" type="date" data-field="date">
        </div>
        <div class="form-group">
          <label class="form-label">Total Hours</label>
          <input class="form-input" type="number" data-field="hours" placeholder="e.g. 4" oninput="recalcTotal()">
        </div>
      </div>
      <div class="events-list" id="events-${dayNum}"></div>
      <button class="add-btn" onclick="addEvent(${dayNum})" style="margin-top:0.5rem;">+ Add Event to Day ${dayNum}</button>
    `;
  } else {
    div.innerHTML = `
      <div class="day-header">
        <div class="day-title">Event Details</div>
      </div>
      <div class="form-row three">
        <div class="form-group">
          <label class="form-label">Date</label>
          <input class="form-input" type="date" data-field="date">
        </div>
        <div class="form-group">
          <label class="form-label">From</label>
          <input class="form-input" type="time" data-field="timeFrom" value="14:00" oninput="recalcTotal()">
        </div>
        <div class="form-group">
          <label class="form-label">To</label>
          <input class="form-input" type="time" data-field="timeTo" value="17:00" oninput="recalcTotal()">
        </div>
      </div>
      <input type="hidden" data-field="hours">
    `;
  }

  document.getElementById('daysContainer').appendChild(div);
  if (wedding) addEvent(dayNum);
  recalcTotal();
}

function removeDay(num) {
  const el = document.getElementById(`day-${num}`);
  if (el) el.remove();
  recalcTotal();
}

function addEvent(dayNum) {
  const container = document.getElementById(`events-${dayNum}`);
  if (!container) return;
  const div = document.createElement('div');
  div.className = 'event-item';
  div.innerHTML = `
    <div class="form-group">
      <label class="form-label">Event Name</label>
      <input class="form-input" data-field="eventName" placeholder="e.g. Wedding Ceremony">
    </div>
    <div class="form-group">
      <label class="form-label">Duration</label>
      <input class="form-input" data-field="eventDuration" placeholder="e.g. 2 Hours">
    </div>
    <div class="form-group">
      <label class="form-label">Notes</label>
      <input class="form-input" data-field="eventNotes" placeholder="e.g. Candid & traditional">
    </div>
    <button class="event-remove" onclick="this.parentElement.remove()">&times;</button>
  `;
  container.appendChild(div);
}

// ===== EVENT TYPE CHANGE =====
function handleEventTypeChange() {
  const wedding = isWeddingEvent();
  document.getElementById('addDayBtn').style.display = wedding ? '' : 'none';

  // If switching away from Wedding with multiple days, trim to 1
  if (!wedding) {
    const blocks = document.querySelectorAll('.day-block');
    if (blocks.length > 1) {
      Array.from(blocks).slice(1).forEach(b => b.remove());
    }
  }

  // Rebuild day blocks for the new event type
  const currentDates = [];
  document.querySelectorAll('.day-block').forEach(b => {
    currentDates.push(b.querySelector('[data-field="date"]')?.value || '');
  });
  document.getElementById('daysContainer').innerHTML = '';
  dayCount = 0;
  const count = wedding ? Math.max(currentDates.length, 1) : 1;
  for (let i = 0; i < count; i++) {
    addDay();
    if (currentDates[i]) {
      const block = document.getElementById(`day-${dayCount}`);
      const dateInput = block.querySelector('[data-field="date"]');
      if (dateInput) dateInput.value = currentDates[i];
    }
  }
  recalcTotal();
}
document.getElementById('eventType').addEventListener('change', handleEventTypeChange);

// ===== PRICING UI =====
function updatePricingUI() {
  const model = document.getElementById('pricingModel').value;
  document.getElementById('hourlyRateGroup').style.display = model === 'hourly' ? '' : 'none';
  document.getElementById('flatRateGroup').style.display = model === 'flat' ? '' : 'none';

  const showIntro = document.getElementById('showIntro').checked;
  document.getElementById('standardRateGroup').style.display = showIntro ? '' : 'none';

  const travelType = document.getElementById('travelType').value;
  document.getElementById('travelFixedRow').style.display = travelType === 'fixed' ? '' : 'none';

  recalcTotal();
}
document.getElementById('travelType').addEventListener('change', updatePricingUI);

function recalcTotal() {
  const model = document.getElementById('pricingModel').value;
  let total = 0;
  let previewHTML = '';

  if (model === 'hourly') {
    const rate = parseFloat(document.getElementById('hourlyRate').value) || 0;
    // Sum hours from all days
    const dayBlocks = document.querySelectorAll('.day-block');
    let totalHours = 0;
    dayBlocks.forEach((block, i) => {
      const timeFrom = block.querySelector('[data-field="timeFrom"]');
      const timeTo = block.querySelector('[data-field="timeTo"]');
      let hrs;
      if (timeFrom && timeTo) {
        hrs = calcHoursFromTime(timeFrom.value, timeTo.value);
        const hiddenHrs = block.querySelector('[data-field="hours"]');
        if (hiddenHrs) hiddenHrs.value = hrs;
      } else {
        hrs = parseFloat(block.querySelector('[data-field="hours"]').value) || 0;
      }
      const dateInput = block.querySelector('[data-field="date"]');
      const dateStr = dateInput.value ? formatDate(dateInput.value) : `Day ${i+1}`;
      totalHours += hrs;
      if (hrs > 0) {
        previewHTML += `<div class="preview-row"><span class="label">${dateStr}: ${hrs} hrs × $${rate}</span><span class="value">$${(hrs * rate).toLocaleString()}</span></div>`;
      }
    });
    total = totalHours * rate;
    previewHTML += `<div class="preview-row total"><span class="label">Base Total (${totalHours} hours)</span><span class="value">$${total.toLocaleString()}</span></div>`;
  } else {
    total = parseFloat(document.getElementById('flatRate').value) || 0;
    previewHTML = `<div class="preview-row total"><span class="label">Package Price</span><span class="value">$${total.toLocaleString()}</span></div>`;
  }

  const travelType = document.getElementById('travelType').value;
  if (travelType === 'fixed') {
    const travelAmt = parseFloat(document.getElementById('travelAmount').value) || 0;
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value">$${travelAmt.toLocaleString()}</span></div>`;
    total += travelAmt;
  } else if (travelType === 'separate') {
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value" style="color:var(--muted)">Separate</span></div>`;
  } else if (travelType === 'included') {
    previewHTML += `<div class="preview-row"><span class="label">Travel & Accommodation</span><span class="value" style="color:var(--gold)">Included</span></div>`;
  }

  document.getElementById('pricingPreview').innerHTML = previewHTML;
  document.getElementById('totalDisplay').textContent = '$' + total.toLocaleString();
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

function formatQuoteDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== RESET =====
function resetForm() {
  if (!confirm('Start a new quote? Current data will be cleared.')) return;
  document.getElementById('clientName').value = '';
  document.getElementById('clientEmail').value = '';
  document.getElementById('clientPhone').value = '';
  document.getElementById('location').value = '';
  document.getElementById('quoteDate').valueAsDate = new Date();
  document.getElementById('eventType').value = 'Wedding Photography';
  document.getElementById('daysContainer').innerHTML = '';
  dayCount = 0;
  addDay();
  handleEventTypeChange();
  document.getElementById('editedCount').value = '200';
  document.getElementById('customNotes').value = '';
  document.getElementById('extraNotes').value = '';
  document.getElementById('termsCheck').checked = false;

  // Reset checkboxes to defaults
  document.getElementById('delEdited').checked = true;
  document.getElementById('delRaw').checked = true;
  document.getElementById('delGallery').checked = true;
  const optional = ['delSneakPeek', 'delTeaser', 'delDoc', 'delTraditional', 'delHighlight', 'delDrone', 'delLive', 'delSecondShooter'];
  optional.forEach(id => { if(document.getElementById(id)) document.getElementById(id).checked = false; });

  recalcTotal();
  showToast('Form reset');
}

// ===== PDF GENERATION =====
async function generatePDF(action = 'download') {
 if (!document.getElementById('termsCheck').checked) {
   alert('Please check the "I approve this quote & terms" box before generating.');
   return;
 }
 try {
  // Pre-load all custom fonts
  const needed = ['cofo-raffine', 'Pinyon Script', 'Playfair Display', 'Cormorant Garamond'];
  const toLoad = [];
  document.fonts.forEach(f => { if (needed.includes(f.family)) toLoad.push(f); });
  await Promise.all(toLoad.map(f => f.load().catch(() => {})));

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'pt', 'letter');
  const W = 612, H = 792;
  const M = 60;

  // Colors
  const GOLD = [201, 149, 107];
  const GOLD_DIM = [160, 120, 86];
  const CREAM = [240, 235, 228];
  const MUTED = [138, 133, 128];
  const DARK_BG = [10, 10, 10];
  const SURFACE = [17, 17, 17];
  const SURFACE2 = [22, 20, 18];
  const WARM = [30, 26, 22];

  // ── Helpers ──
  function pageBg() {
    doc.setFillColor(...DARK_BG);
    doc.rect(0, 0, W, H, 'F');
  }

  function watermark() {
    const cvs = document.createElement('canvas');
    const s = 2;
    cvs.width = W * s;
    cvs.height = 60 * s;
    const ctx = cvs.getContext('2d');
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.font = '500 ' + (48 * s) + 'px "cofo-raffine", sans-serif';
    ctx.fillStyle = 'rgba(201, 149, 107, 0.025)';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('AAKAARA', cvs.width / 2, cvs.height / 2);
    const img = cvs.toDataURL('image/png');
    doc.addImage(img, 'PNG', 0, H / 2 - 30, W, 60);
  }

  // Render web-font text via canvas → PDF image
  function fancyText(text, family, weight, sizePt, color, x, y, align, style) {
    const s = 3;
    const px = Math.round(sizePt * 1.333);
    const cFont = (style === 'italic' ? 'italic ' : '') + weight + ' ' + (px * s) + 'px "' + family + '", serif';
    const tmp = document.createElement('canvas').getContext('2d');
    tmp.font = cFont;
    const tw = tmp.measureText(text).width;
    const pad = 8 * s;
    const cvs = document.createElement('canvas');
    cvs.width = Math.ceil(tw + pad * 2);
    cvs.height = Math.ceil(px * s * 1.7);
    const ctx = cvs.getContext('2d');
    ctx.font = cFont;
    ctx.fillStyle = 'rgb(' + color.join(',') + ')';
    ctx.textBaseline = 'alphabetic';
    ctx.textAlign = 'center';
    ctx.fillText(text, cvs.width / 2, cvs.height * 0.62);
    const pW = cvs.width / s, pH = cvs.height / s;
    const img = cvs.toDataURL('image/png');
    let dx = x;
    if (align === 'center') dx = x - pW / 2;
    else if (align === 'right') dx = x - pW;
    doc.addImage(img, 'PNG', dx, y - pH * 0.62, pW, pH);
  }

  function goldLine(x1, y, x2) {
    doc.setDrawColor(...GOLD); doc.setLineWidth(0.5);
    doc.line(x1, y, x2, y);
  }

  function thinGoldLine(x1, y, x2) {
    doc.setDrawColor(...GOLD_DIM); doc.setLineWidth(0.3);
    doc.line(x1, y, x2, y);
  }

  function centeredGoldLine(y, halfWidth) {
    doc.setDrawColor(...GOLD); doc.setLineWidth(0.4);
    doc.line(W/2 - halfWidth, y, W/2 + halfWidth, y);
  }

  function footerBar() {
    goldLine(M, H - 70, W - M);
    doc.setFontSize(6); doc.setTextColor(...MUTED);
    doc.text('aakaarastudiosnyc.com  |  avala.sudhakar@gmail.com  |  +1 (475) 332-2020', W/2, H - 52, { align: 'center' });
  }

  function headerBar(page, total) {
    doc.setFontSize(6); doc.setTextColor(...GOLD);
    doc.text('A A K A A R A   S T U D I O S', M, 38);
    doc.text(`${String(page).padStart(2,'0')} / ${String(total).padStart(2,'0')}`, W - M, 38, { align: 'right' });
    goldLine(M, 48, W - M);
  }

  function sectionLabel(text, yPos) {
    doc.setFontSize(5.5); doc.setTextColor(...GOLD);
    doc.text(text, M, yPos);
    const tw = doc.getTextWidth(text);
    thinGoldLine(M + tw + 8, yPos - 2, W - M);
    return yPos + 20;
  }

  // ── Gather Data ──
  const clientName = document.getElementById('clientName').value || 'Client';
  const clientEmail = document.getElementById('clientEmail').value || '';
  const clientPhone = document.getElementById('clientPhone').value || '';
  const eventType = document.getElementById('eventType').value;
  const location = document.getElementById('location').value || 'TBD';
  const quoteDate = document.getElementById('quoteDate').value;
  const quoteDateFormatted = quoteDate ? formatQuoteDate(quoteDate) : 'N/A';
  const model = document.getElementById('pricingModel').value;
  const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 0;
  const flatRate = parseFloat(document.getElementById('flatRate').value) || 0;
  const travelType = document.getElementById('travelType').value;
  const showIntro = document.getElementById('showIntro').checked;
  const standardRate = document.getElementById('standardRate').value;
  const editedCount = document.getElementById('editedCount').value || '200';
  const timeline = document.getElementById('timeline').value || '6-8 weeks';
  const deposit = document.getElementById('deposit').value;
  const validity = document.getElementById('validity').value || '30 days';

  const days = [];
  document.querySelectorAll('.day-block').forEach((block, i) => {
    const date = block.querySelector('[data-field="date"]').value;
    const hours = block.querySelector('[data-field="hours"]').value;
    const events = [];
    block.querySelectorAll('.event-item').forEach(ev => {
      const name = ev.querySelector('[data-field="eventName"]').value;
      const dur = ev.querySelector('[data-field="eventDuration"]').value;
      const notes = ev.querySelector('[data-field="eventNotes"]').value;
      if (name) events.push({ name, dur, notes });
    });
    const timeFrom = block.querySelector('[data-field="timeFrom"]')?.value || '';
    const timeTo = block.querySelector('[data-field="timeTo"]')?.value || '';
    days.push({ date, hours, events, timeFrom, timeTo });
  });

  const totalHours = days.reduce((s, d) => s + (parseFloat(d.hours) || 0), 0);
  const totalPages = 4;

  // Deliverable items
  const delItems = [];
  if (document.getElementById('delEdited').checked) delItems.push(['Edited Photos', editedCount + ' professionally graded images']);
  if (document.getElementById('delRaw').checked) delItems.push(['Raw Images', 'Complete gallery delivered']);
  if (document.getElementById('delGallery').checked) delItems.push(['Online Gallery', 'Private link for viewing & downloads']);
  if (document.getElementById('delSneakPeek').checked) delItems.push(['Sneak Peek Reels', 'Same-day delivery (within 24hrs)']);
  if (document.getElementById('delTeaser').checked) delItems.push(['Wedding Teaser', '2-3 minute cinematic highlight reel']);
  if (document.getElementById('delDoc').checked) delItems.push(['Documentary Film', '10 min with couple & family interviews']);
  if (document.getElementById('delTraditional').checked) delItems.push(['Traditional Video', 'Full-length ceremony coverage']);
  if (document.getElementById('delHighlight').checked) delItems.push(['Highlight Video', '2-3 minute cinematic edit']);
  if (document.getElementById('delDrone').checked) delItems.push(['Drone Footage', 'Aerial coverage where permitted']);
  if (document.getElementById('delLive').checked) delItems.push(['Live Coverage', 'Ceremony livestream (venue internet required)']);
  if (document.getElementById('delSecondShooter').checked) delItems.push(['Second Photographer', 'Full dual-perspective coverage']);

  const firstName = clientName.split('&')[0].split(' ')[0].trim();


  // ═══════════════════════════════════════════════════════
  //  PAGE 1 — COVER
  // ═══════════════════════════════════════════════════════
  pageBg();
  watermark();

  // Top gold accent line
  goldLine(M, 50, W - M);

  // Brand mark area
  doc.setFontSize(9); doc.setTextColor(...GOLD);
  doc.text('A A K A A R A', W/2, 130, { align: 'center' });
  doc.setFontSize(5.5); doc.setTextColor(...MUTED);
  doc.text('S T U D I O S   ·   N E W   Y O R K   C I T Y', W/2, 144, { align: 'center' });

  // Tagline
  doc.setFontSize(7.5); doc.setTextColor(...GOLD_DIM);
  doc.text('Every story deserves its own canvas.', W/2, 168, { align: 'center' });

  centeredGoldLine(185, 40);

  // Main title — cofo-raffine
  const titleText = eventType.replace(' Photography', '');
  fancyText(titleText, 'cofo-raffine', 500, 36, CREAM, W/2, 240, 'center');
  fancyText('Photography', 'cofo-raffine', 400, 14, GOLD, W/2, 264, 'center');

  // Subtitle
  doc.setFontSize(8); doc.setTextColor(...MUTED);
  doc.text('Coverage Proposal', W/2, 286, { align: 'center' });

  centeredGoldLine(302, 30);

  // Personal greeting — Pinyon Script + Playfair Display
  fancyText('Prepared for', 'Pinyon Script', 400, 11, CREAM, W/2, 332, 'center');
  fancyText(clientName, 'Playfair Display', 400, 22, GOLD, W/2, 360, 'center');

  // Warm personal note — Cormorant Garamond italic
  fancyText('We are truly excited to be a part of your special day.', 'Cormorant Garamond', 300, 8.5, MUTED, W/2, 388, 'center', 'italic');

  // Event details box
  let y = 420;
  y = sectionLabel('EVENT DETAILS', y);

  const coverDetails = [
    ['Location', location],
  ];
  if (clientEmail) coverDetails.push(['Email', clientEmail]);
  if (clientPhone) coverDetails.push(['Phone', clientPhone]);
  if (days.length === 1) {
    coverDetails.push(['Date', days[0].date ? formatDate(days[0].date) : 'TBD']);
    if (days[0].timeFrom && days[0].timeTo) {
      coverDetails.push(['Time', formatTime12(days[0].timeFrom) + ' — ' + formatTime12(days[0].timeTo)]);
    }
    coverDetails.push(['Duration', (days[0].hours || '0') + ' Hours of Coverage']);
  } else if (days.length > 1) {
    days.forEach((d, i) => {
      coverDetails.push([`Day ${i+1}`, (d.date ? formatDate(d.date) : 'TBD') + '  —  ' + (d.hours || '0') + ' Hours']);
    });
    coverDetails.push(['Total Coverage', totalHours + ' Hours across ' + days.length + ' Days']);
  }

  coverDetails.forEach(([label, value]) => {
    doc.setFillColor(...SURFACE);
    doc.roundedRect(M, y - 10, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    doc.text(label.toUpperCase(), M + 14, y + 2);
    doc.setFontSize(8.5); doc.setTextColor(...CREAM);
    doc.text(value, W - M - 14, y + 2, { align: 'right' });
    y += 28;
  });

  // Quote date
  doc.setFontSize(6); doc.setTextColor(...MUTED);
  doc.text('Proposal Date: ' + quoteDateFormatted, W/2, y + 14, { align: 'center' });

  // Bottom gold line
  goldLine(M, H - 85, W - M);
  footerBar(false);


  // ═══════════════════════════════════════════════════════
  //  PAGE 2 — EVENT SCHEDULE
  // ═══════════════════════════════════════════════════════
  doc.addPage();
  pageBg();
  watermark();
  headerBar(2, totalPages);

  y = 68;
  y = sectionLabel('EVENT SCHEDULE', y);

  const isWedding = isWeddingEvent();
  days.forEach((day, di) => {
    // Day header
    doc.setFillColor(...WARM);
    doc.roundedRect(M, y - 10, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(6); doc.setTextColor(...GOLD);
    doc.text(isWedding ? `DAY ${di+1}` : 'EVENT', M + 14, y + 3);
    doc.setFontSize(7.5); doc.setTextColor(...CREAM);
    const dayDateStr = day.date ? formatDate(day.date) : 'Date TBD';
    doc.text(dayDateStr, W/2, y + 3, { align: 'center' });
    doc.setFontSize(7); doc.setTextColor(...GOLD);
    doc.text((day.hours || '0') + ' Hours', W - M - 14, y + 3, { align: 'right' });
    y += 28;

    if (day.timeFrom && day.timeTo) {
      // Non-wedding: show time range
      doc.setFillColor(...SURFACE);
      doc.roundedRect(M + 8, y - 10, W - 2*M - 16, 26, 3, 3, 'F');
      doc.setFillColor(...GOLD);
      doc.circle(M + 18, y + 1, 2, 'F');
      doc.setFontSize(9); doc.setTextColor(...CREAM);
      doc.text(eventType, M + 26, y + 1);
      doc.setFontSize(7.5); doc.setTextColor(...GOLD);
      doc.text(formatTime12(day.timeFrom) + '  —  ' + formatTime12(day.timeTo), W - M - 22, y + 1, { align: 'right' });
      y += 30;
    } else {
      // Wedding: show individual events
      day.events.forEach(ev => {
        doc.setFillColor(...SURFACE);
        doc.roundedRect(M + 8, y - 10, W - 2*M - 16, 26, 3, 3, 'F');
        doc.setFillColor(...GOLD);
        doc.circle(M + 18, y + 1, 2, 'F');
        doc.setFontSize(9); doc.setTextColor(...CREAM);
        doc.text(ev.name, M + 26, y + 1);
        if (ev.notes) {
          doc.setFontSize(6.5); doc.setTextColor(...MUTED);
          doc.text(ev.notes, M + 26, y + 11);
        }
        if (ev.dur) {
          doc.setFontSize(7.5); doc.setTextColor(...GOLD);
          doc.text(ev.dur, W - M - 22, y + 1, { align: 'right' });
        }
        y += 30;
      });
    }
    y += 6;
  });

  // Total coverage summary
  y += 2;
  doc.setFillColor(...WARM);
  doc.roundedRect(M, y - 8, W - 2*M, 24, 4, 4, 'F');
  doc.setDrawColor(...GOLD); doc.setLineWidth(0.4);
  doc.roundedRect(M, y - 8, W - 2*M, 24, 4, 4, 'S');
  doc.setFontSize(7); doc.setTextColor(...CREAM);
  doc.text('TOTAL COVERAGE', M + 14, y + 5);
  doc.setFontSize(9); doc.setTextColor(...GOLD);
  doc.text(totalHours + ' Hours  ·  ' + days.length + (days.length === 1 ? ' Day' : ' Days'), W - M - 14, y + 5, { align: 'right' });

  footerBar(true);


  // ═══════════════════════════════════════════════════════
  //  PAGE 3 — DELIVERABLES + SCOPE
  // ═══════════════════════════════════════════════════════
  doc.addPage();
  pageBg();
  watermark();
  headerBar(3, totalPages);

  y = 68;
  y = sectionLabel('WHAT YOU RECEIVE', y);

  // Table header
  doc.setFillColor(...WARM);
  doc.roundedRect(M, y - 8, W - 2*M, 18, 3, 3, 'F');
  doc.setFontSize(5.5); doc.setTextColor(...GOLD);
  doc.text('DELIVERABLE', M + 14, y + 2);
  doc.text('DETAILS', W - M - 14, y + 2, { align: 'right' });
  y += 24;

  // Alternating rows
  delItems.forEach(([item, detail], idx) => {
    if (idx % 2 === 0) {
      doc.setFillColor(14, 14, 14);
      doc.roundedRect(M, y - 10, W - 2*M, 18, 2, 2, 'F');
    }
    // Gold bullet
    doc.setFillColor(...GOLD);
    doc.circle(M + 10, y - 1, 1.2, 'F');

    doc.setFontSize(8); doc.setTextColor(...CREAM);
    doc.text(item, M + 18, y);
    doc.setFontSize(7.5); doc.setTextColor(...MUTED);
    doc.text(detail, W - M - 14, y, { align: 'right' });
    y += 19;
  });

  // Delivery timeline
  y += 8;
  doc.setFillColor(...SURFACE);
  doc.roundedRect(M, y - 8, W - 2*M, 22, 3, 3, 'F');
  doc.setFontSize(6.5); doc.setTextColor(...MUTED);
  doc.text('DELIVERY TIMELINE', M + 14, y + 4);
  doc.setFontSize(8); doc.setTextColor(...CREAM);
  doc.text('Final deliverables within ' + timeline, W - M - 14, y + 4, { align: 'right' });

  // Live wedding highlight box
  if (document.getElementById('delLive').checked) {
    y += 28;
    doc.setFillColor(...WARM);
    doc.roundedRect(M, y - 8, W - 2*M, 28, 4, 4, 'F');
    doc.setDrawColor(...GOLD); doc.setLineWidth(0.6);
    doc.roundedRect(M, y - 8, W - 2*M, 28, 4, 4, 'S');
    doc.setFontSize(5.5); doc.setTextColor(...GOLD);
    doc.text('HIGHLIGHTED', M + 14, y + 1);
    doc.setFontSize(9); doc.setTextColor(...CREAM);
    doc.text('Live Wedding Coverage', M + 14, y + 12);
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    doc.text('Ceremony livestream included (venue must provide internet)', M + 130, y + 12);
  }

  // Approach note
  y += 30;
  centeredGoldLine(y, 30);
  y += 16;
  doc.setFontSize(7.5); doc.setTextColor(...MUTED);
  doc.text('Our approach blends cinematic storytelling with candid emotion.', W/2, y, { align: 'center' });
  doc.text('Every frame is crafted to feel timeless, not trendy.', W/2, y + 14, { align: 'center' });

  footerBar(true);


  // ═══════════════════════════════════════════════════════
  //  PAGE 4 — INVESTMENT + CLOSING
  // ═══════════════════════════════════════════════════════
  doc.addPage();
  pageBg();
  watermark();
  headerBar(4, totalPages);

  y = 68;
  y = sectionLabel('YOUR INVESTMENT', y);

  // Investment box
  const boxH = model === 'hourly' ? 85 : 65;
  doc.setFillColor(...SURFACE);
  doc.roundedRect(M, y - 8, W - 2*M, boxH, 5, 5, 'F');
  doc.setDrawColor(...GOLD); doc.setLineWidth(0.5);
  doc.roundedRect(M, y - 8, W - 2*M, boxH, 5, 5, 'S');

  if (showIntro) {
    doc.setFillColor(...WARM);
    doc.roundedRect(M + 15, y - 2, 110, 14, 7, 7, 'F');
    doc.setFontSize(5.5); doc.setTextColor(...GOLD);
    doc.text('INTRODUCTORY RATE', M + 70, y + 8, { align: 'center' });
  }

  if (model === 'hourly') {
    const rateY = showIntro ? 22 : 10;
    doc.setFontSize(5.5); doc.setTextColor(...MUTED);
    doc.text('RATE', M + 18, y + rateY);
    doc.setFontSize(30); doc.setTextColor(...CREAM);
    doc.text('$' + hourlyRate, M + 18, y + rateY + 28);
    doc.setFontSize(9); doc.setTextColor(...MUTED);
    doc.text('/ hour', M + 85, y + rateY + 24);

    // Breakdown
    doc.setFontSize(5.5); doc.setTextColor(...MUTED);
    doc.text('BREAKDOWN', W/2 + 15, y + rateY);
    let by = y + rateY + 14;
    let baseTotal = 0;
    days.forEach((d, i) => {
      const hrs = parseFloat(d.hours) || 0;
      const amt = hrs * hourlyRate;
      baseTotal += amt;
      doc.setFontSize(7.5); doc.setTextColor(...CREAM);
      doc.text('Day ' + (i+1) + ':  ' + hrs + ' hrs  ×  $' + hourlyRate, W/2 + 15, by);
      doc.setTextColor(...GOLD);
      doc.text('$' + amt.toLocaleString(), W - M - 18, by, { align: 'right' });
      by += 14;
    });
    thinGoldLine(W/2 + 15, by - 3, W - M - 18);
    doc.setFontSize(9); doc.setTextColor(...CREAM);
    doc.text('Base Total', W/2 + 15, by + 8);
    doc.setFontSize(10); doc.setTextColor(...GOLD);
    doc.text('$' + baseTotal.toLocaleString(), W - M - 18, by + 8, { align: 'right' });
  } else {
    const rateY = showIntro ? 22 : 10;
    doc.setFontSize(5.5); doc.setTextColor(...MUTED);
    doc.text('PACKAGE PRICE', M + 18, y + rateY);
    doc.setFontSize(30); doc.setTextColor(...CREAM);
    doc.text('$' + flatRate.toLocaleString(), M + 18, y + rateY + 28);
    doc.setFontSize(8); doc.setTextColor(...MUTED);
    doc.text('All-inclusive coverage package', W/2 + 15, y + rateY + 14);
  }

  if (showIntro && standardRate) {
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    const srText = 'Standard rate: ' + standardRate;
    doc.text(srText, M + 18, y + boxH - 14);
    const srWidth = doc.getTextWidth(srText);
    doc.setDrawColor(...MUTED); doc.setLineWidth(0.4);
    doc.line(M + 18, y + boxH - 17, M + 18 + srWidth, y + boxH - 17);
  }

  y += boxH + 14;

  // Travel
  if (travelType === 'separate') {
    doc.setFillColor(...SURFACE);
    doc.roundedRect(M, y - 6, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    doc.text('TRAVEL & ACCOMMODATION', M + 14, y + 6);
    doc.setFontSize(8); doc.setTextColor(...CREAM);
    doc.text('Calculated separately', W - M - 14, y + 6, { align: 'right' });
    y += 30;
  } else if (travelType === 'fixed') {
    const tAmt = parseFloat(document.getElementById('travelAmount').value) || 0;
    doc.setFillColor(...SURFACE);
    doc.roundedRect(M, y - 6, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    doc.text('TRAVEL & ACCOMMODATION', M + 14, y + 6);
    doc.setFontSize(8); doc.setTextColor(...GOLD);
    doc.text('$' + tAmt.toLocaleString(), W - M - 14, y + 6, { align: 'right' });
    y += 30;
  } else if (travelType === 'included') {
    doc.setFillColor(...SURFACE);
    doc.roundedRect(M, y - 6, W - 2*M, 22, 3, 3, 'F');
    doc.setFontSize(6.5); doc.setTextColor(...MUTED);
    doc.text('TRAVEL & ACCOMMODATION', M + 14, y + 6);
    doc.setFontSize(8); doc.setTextColor(...GOLD);
    doc.text('Included', W - M - 14, y + 6, { align: 'right' });
    y += 30;
  }

  // Terms section
  y += 5;
  y = sectionLabel('TERMS', y);

  const addInfo = [
    ['Deposit', deposit],
    ['Delivery', 'Final deliverables within ' + timeline],
    ['Validity', 'This proposal is valid for ' + validity],
  ];
  const extraNotes = document.getElementById('extraNotes').value;
  if (extraNotes) {
    extraNotes.split('\n').forEach(line => {
      if (line.trim()) {
        const parts = line.split(':');
        if (parts.length > 1) {
          addInfo.push([parts[0].trim(), parts.slice(1).join(':').trim()]);
        } else {
          addInfo.push(['Note', line.trim()]);
        }
      }
    });
  }

  addInfo.forEach(([label, detail]) => {
    doc.setFontSize(7); doc.setTextColor(...CREAM);
    doc.text(label, M + 8, y);
    doc.setFontSize(7); doc.setTextColor(...MUTED);
    doc.text(detail, M + 100, y);
    y += 16;
  });

  // ── Cinematic Closing ──
  y += 25;
  centeredGoldLine(y, 50);
  y += 30;

  // Thank you — Cormorant Garamond light
  fancyText(firstName + ', thank you for trusting us with your story.', 'Cormorant Garamond', 300, 11, CREAM, W/2, y, 'center');
  y += 24;
  // Emotional quotes — Cormorant Garamond italic
  fancyText('We don\u2019t just photograph moments \u2014 we preserve the emotions within them.', 'Cormorant Garamond', 300, 8.5, MUTED, W/2, y, 'center', 'italic');
  y += 15;
  fancyText('It would be an honor to be part of your celebration.', 'Cormorant Garamond', 300, 8.5, MUTED, W/2, y, 'center', 'italic');

  y += 32;
  // "With warmth," — Pinyon Script cursive
  fancyText('With warmth,', 'Pinyon Script', 400, 12, GOLD, W/2, y, 'center');
  y += 18;
  // Signature — Playfair Display bold
  fancyText('Sudhakar Avula', 'Playfair Display', 700, 12, CREAM, W/2, y, 'center');
  y += 13;
  doc.setFontSize(6.5); doc.setTextColor(...MUTED);
  doc.text('Founder & Lead Photographer, Aakaara Studios', W/2, y, { align: 'center' });

  // Bottom accent
  y += 24;
  centeredGoldLine(y, 25);
  y += 14;
  // Tagline — Cormorant Garamond italic
  fancyText('Every story deserves its own canvas.', 'Cormorant Garamond', 300, 8, GOLD_DIM, W/2, y, 'center', 'italic');

  footerBar(false);


  // ── Output ──
  const safeName = clientName.replace(/[^a-zA-Z0-9]/g, '_');
  window._currentPdfDoc = doc;
  window._currentPdfName = `Aakaara_Studios_Quote_${safeName}.pdf`;

  if (action === 'preview') {
    const blob = doc.output('blob');
    const url = URL.createObjectURL(blob);
    document.getElementById('previewFrame').src = url;
    document.getElementById('previewModal').classList.add('show');
    showToast('Preview ready!');
  } else {
    doc.save(window._currentPdfName);
    showToast('PDF generated & downloading!');
  }
 } catch(e) {
  console.error('PDF generation error:', e);
  alert('Error generating PDF: ' + e.message);
 }
}

function closePreviewModal() {
  const modal = document.getElementById('previewModal');
  modal.classList.remove('show');
  const frame = document.getElementById('previewFrame');
  if (frame.src) { URL.revokeObjectURL(frame.src); frame.src = ''; }
}

function downloadFromPreview() {
  if (window._currentPdfDoc) {
    window._currentPdfDoc.save(window._currentPdfName || 'Aakaara_Quote.pdf');
    showToast('PDF downloaded!');
  }
}

// ===== EMAILJS =====
const EMAILJS_PUBLIC_KEY = '9JvEoBTlynbZjT45z';
const EMAILJS_SERVICE_ID = 'service_x3ggfs3';
const EMAILJS_TEMPLATE_ID = 'template_9r404u1';

function sendToClient() {
  const clientEmail = document.getElementById('clientEmail').value.trim();
  const clientName = document.getElementById('clientName').value.trim() || 'Client';
  const eventType = document.getElementById('eventType').value;

  if (!clientEmail) {
    alert('Please enter the client\'s email address before sending.');
    return;
  }

  if (!window._currentPdfDoc) {
    alert('Please generate a preview first.');
    return;
  }

  // Download the PDF first
  window._currentPdfDoc.save(window._currentPdfName || 'Aakaara_Quote.pdf');

  // Build email content
  const subject = encodeURIComponent(`Aakaara Studios — ${eventType} Proposal for ${clientName}`);
  const body = encodeURIComponent(`Hi ${clientName.split(' ')[0]},\n\nThank you for considering Aakaara Studios for your upcoming ${eventType.replace(' Photography', '').toLowerCase()}. Please find your personalized proposal attached.\n\nWe would love to be part of your special day! Feel free to review the details and reach out with any questions.\n\nWith warmth,\nSudhakar Avula\nAakaara Studios\ninfo@aakaarastudiosnyc.com`);

  // Open Gmail compose with pre-filled fields
  const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(clientEmail)}&su=${subject}&body=${body}`;
  window.open(gmailUrl, '_blank');

  showToast('PDF downloaded! Gmail compose opened — just attach the PDF and send.');
  closePreviewModal();
}

// Init
addDay();
handleEventTypeChange();
recalcTotal();

// Listen for changes
document.addEventListener('input', recalcTotal);
</script>

</body>
</html>